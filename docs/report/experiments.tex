\section{Experiments}

\subsection{Setting warm-up and simulation times}

\begin{minipage}{.6\textwidth}
  In order to define the required warm-up period, we plotted the response time as a function of the simulation time for 10 different runs. The runs were configured in order to represent a worst-case scenario: $\lambda_V=1.3, \lambda_N=0.1,\pi_C=0.1,\mu_K=0.2,\mu_C=1.5$. An example of the plots can be seen in the picture on the right, where simple normal orders are shown. From the plot we can see that the mean starts converging at around 30000m therefore we chose 50000m in order to have some safety margin since running the simulations is quite inexpensive.
\end{minipage}
\begin{minipage}{.4\textwidth}
  \centering
  \includegraphics[width=\textwidth]{figs/warmup_definition.pdf}
  \label{fig:warmup}
\end{minipage}

After having chosen the warm-up period, the simulation time was chosen as to have both a high level of accuracy and a small execution time. The value of 500000m has hence been chosen since it provides a confidence interval around 2\% with 90\% confidence in the above worst-case scenario.

\subsection{Steady-state analyses}

\subsubsection{2kr analysis}
In order to grasp the factors contribution to the customers experience, we computed a number of 2$^k$r (r = 5) factorial analysis. In these analyses, we took into 
consideratione the following factors in the FIFO kitchen and exponential service and inter-arrival rates scenario: 
\begin{itemize}
  \item A = normal customers rate (vip rate is set as to keep the total rate constant) $[0.1, 1.2]$
  \item B = odds of an order being a Compound one $[0.1, 0.3]$
  \item C = kitchen Rate $[0.45, 0.6]$
  \item D = cashier Rate $[1.5, 2]$
\end{itemize}
Please note that A is, in reality, a measure of the numer of number customers 
over the total, ranging from ~10\% to ~90\%.

The interesting results we found are:
\begin{itemize}
  \item the cashier rate has a negative impact (-0.159, with an explained 92\%
   variability) on the advantage of VIP customers 
    on normal customers since an increase of it implies lower queueing and thus 
    a more ``equal'' waiting time between VIP and normal users.
  \item parameter A has a negative contribution on the advantage of VIP       
    customers on normal customers. This is somewhat unexpected since you would 
    expect the VIP advantage to increase if fewer VIP customers are present.
    However, this results highlights the phenomenon of ``quasi-starvation''
    happening to normal customer with an high number of VIP customers. In fact:
      \begin{itemize}
        \item Many VIP users, few Normal users: VIP customers experience longer 
          waiting times (than if they were fewer), while normal users experience huge waiting times due to too many VIP arrivals jumping in queue in front of them.
        \item Few VIP users, many Normal users: VIP customers are serviced very fast, but normal user are no more ``starvated'' by VIPs. The Normal response time has lowered much more from the previous case, compared to the Vip response time, leading to a lower the simpleResponseTimeRatio.
        \item the cashier rate has a negligible influence on the kitchen queue length. This phenomenon will be further investigated in \cref{sec:cashier_no_infl}.
      \end{itemize}
\end{itemize} % si pu√≤ tagliare ancora se serve

% % OLD 2kr
% \subsection{Fifo Scenario}

% \subsubsection{simpleResponseTimeRatio}

% \input{Analysis/Fifo/simpleResponseTimeRatioFifo/latexResults.tex}
 
% There's no particular interplay occurring between factors, we can clearly see that the simpleResponseTimeRatio depends on:
% \begin{itemize}
%     \item The main reason why VIP users are privileged is due to the queueing of orders, if there's no queue the difference of Normal and Vip response times are negligible. This is exactly why the cashier rate has a negative contribution: with the increase of this factor there's less queueing and thus when a new normal order comes chances are that there will be no Vip users in queue so it can be served immediately.
%   \item The ratio between the amount of VIP and Normal users (A) has a negative contribution, this is a little bit unexpected. The reason has a connection with the starvation of Normal users. Let's try to break it up in two cases: 

% \end{itemize}

% %\input{Analysis/Fifo/compoundResponseTimeRatioFifo/latexResults.tex} TODO path to compoundResponseTimeRatio FIFO

% %da decidere se inserire anche questa statistica
% \subsubsection{cashierVipQueueLength}

% \input{Analysis/Fifo/cashierVipQueueLengthFifo/latexResults.tex}
% We can observe that:
% \begin{itemize}
%     \item if the Vip arrival rate decreases (factor A increases) the VIP queue length will also decrease accordingly.
%     \item by increasing the cashier rate Vip queue length will also decrease.
%     \item Here we can also see an interesting interplay by factor A and D, meaning that a good portion of the variation is explained by the interaction of those factors.
% \end{itemize}

% \subsubsection{cashierNormalQueueLength}
% \input{Analysis/Fifo/cashierNormalQueueLengthFifo/latexResults.tex}

% Basically all the observation done for the cashierVipQueueLength remains with minor changes. We can observe that now factor A has a positive contribution, this was to be expected because by increasing factor A we increase the Normal arrival rate meaning that new Normal orders are subject to longer queue.

% \subsubsection{kitchenQueueLength}

% \input{Analysis/Fifo/fifoQueueLength/latexResults.tex}

% In this particular scenario the kitchen has no priority queue. This means that all the orders coming from the cashier are treated in the same way, even if they are VIP. Of course, by that, we can expect that factor A would not bring any contribution to the variation and it's exactly what we can see from the results. Instead:
% \begin{itemize}
%     \item factor B has high positive contribution. By increasing it (probability of compound orders increase) we can expect longer queue.
%     \item of course by increasing factor C (kitchen rate) we can expect shorter queue in the kitchen.
%     \item Here we can also see an interesting interplay by factor A and D, meaning that a good portion of the variation is explained by the interaction of those factors.
% \end{itemize}

% \subsection{Priority Scenario}

% For what concern the cashier part of the system, all the observations done in the Fifo scenario still holds. In fact we can see that all the results are exactly the same, so we will not discuss this case any further.

% %\input{Analysis\Fifo\} TODO path to compoundResponseTimeRatio Priority

% %spiegazione

% \subsubsection{kitchenVipQueueLength}
% \input{Analysis/Priority/kitchenVipQueueLengthPriority/latexResults.tex}

% \begin{itemize}
%     \item by increasing factor A (Normal Arrival Rate increases, Vip arrival Rate decreases) the VIP queue length tends to decrease.
%     \item by increasing factor B (probability of compound orders), the total inter-arrival rate of the kitchen increases too so new orders are more subject to queueing.
%     \item of course, by increasing the Kitchen Rate (factor C) the length of VIP Queue length decreases.
%     \item of course by being a Pasta system (no orders are created or destroyed inside the system), the inter-arrival rate of the cashier is also the inter-departure rate and, by that, we can be sure that the cashier rate (factors D) brings no contribution to the Normal Queue Length in the kitchen. %TODO da controllare
% \end{itemize}

% \subsubsection{kitchenNormalQueueLength}
% \input{Analysis/Priority/kitchenNormalQueueLengthPriority/latexResults.tex}

% We can observe that:
% \begin{itemize}
%     \item by increasing factor A (Normal Arrival Rate increases) the Normal queue length tends to increase too.
%     \item by increasing factor B (probability of compound orders), the total inter-arrival rate of the kitchen increases too so new orders are more subject to queueing.
%     \item of course, by increasing the Kitchen Rate (factor C) the length of Normal Queue length decreases.
%     \item of course by being a Pasta system (no orders are created or destroyed inside the system), the inter-arrival rate of the cashier is also the inter-departure rate and, by that, we can be sure that the cashier rate brings no contribution to the Normal Queue Length in the kitchen. %TODO da controllare
%     \item all the interplays bring negligible contributions apart from the BC one which should be taken into consideration when tuning the system. %TODO dacontrollare
% \end{itemize}

\subsection{Compare Kitchen Queue}

Now we want to assess if implementing a priority queue in the kitchen brings any perks. In order to get that results we observe the trajectories of the compoundResponseTimeRatio statistic in both cases, fifo queue and priority queue, varying the probability of compound orders.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/comparisonQueue.png}
\end{figure}

We can clearly see that by increasing the odds of compound orders, in the fifo case, Vip users tends to lose the "advantage" obtained during the cashier service. So, indeed, by using a priority queue in kitchen we can guarantee an even more privileged service. But is it necessary? Of course not, it depends on the type of service that the Bar Administrator strive to get. In fact we see that even without using a priority queue in the kitchen, the advantage obtained during tha cashier service is enough to let Vip user have some benefits (around 2m) even in case of compound orders:

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/comparisonFifoKitchen.png}
\end{figure}

\subsection{System Response to different Workloads}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/workloadSimple.png}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/workloadCompound.png}
\end{figure}

Note that the Inter-Arrival rate for the kitchen with this configuration is actually 0.2 * "value showed in the x axis". We kept those numbers only to let the reader catch the similarities with the previous graph. %TODO da controllare

\subsection{Vip Rate study}

One of the things that should be taken into consideration when fine-tuning the system is the amount of allowed VIP users. Of course if all users are VIP there would be no benefit, all the observation discussed until now would makes no sense and chance are that the few Normal user that comes will never be served. So, in order to decide the correct percentage of allowed VIP users, that permits a reasonable response time for Normal User along with some benefits to the Vip ones, we executed a full factorial analysis with the following configuration:
 
 %TODO configurazione Omnetpp

 By changing only the percentage of VIP users we can set a reasonable response time for Normal user (we opted for 15m) and establish the optimal percentage of Vip users which we found it to be between 10\% and 30\%.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/comparisonSimpleResponseTime.png}
\end{figure}

 We can also plot the simpleResponseTimeRatio with the same configuration and ensure that, in fact, Vip users are at least 80\% faster than Normal users in that range.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/simpleResponseTimeRatio.png}
\end{figure}

All the above can be repeated for the kitchen in the Priority case to get similar results. In fact we can expect a fairly reasonable response time from normal users in the same range:

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{figs/comparisonCompoundResponseTime.png}
\end{figure}

\subsubsection{Relationship between service rates proportion and queue lengths}
\label{sec:cashier_no_infl}
% cashier queue is obv influenced only by its rate
% kitchen queue is influenced only by its own rate (as in math. model) in both fifo and priority kitchen queue strategies

\subsubsection{}

\subsection{``Business day'' analysis (TODO: 0.5-1 pages)}

\section{Conclusions (TODO: 0.5 pages)}
