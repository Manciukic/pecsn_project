\section{Experiments}

\subsection{Design}
In order to offer the best possible service, we need to properly tune every factor on which the system depends on:
\begin{itemize}
    \item cashier service rate \mu_C
    \item kitchen service rate \mu_K
    \item odds of an order being a Simple one \pi_S= 1-\pi_C 
    \item odds of an order being a Compound one \pi_C 
    \item inter-arrival rate of Vip orders \lambda_V
    \item inter-arrival rate of Normal orders \lambda_N
    \item Kitchen queue type, "fifo" or "priority"
\end{itemize}

We'll try to summarize all the information that could be useful to a Bar's Administrator, mainly focusing on granting privileged services to Vip users.
To analyze how much a VIP user gains, in terms of Response Time, compared to a Normal User, we added two new statistics called "simpleResponseTimeRatio" and "compoundResponseTimeRatio", respectively for simple orders and compound orders. They are computed as follows:
    simpleResponseTimeRatio &= 1-{\frac{E[R_{V,S}]}{E[R_{N,S}]}
    compoundResponseTimeRatio &= 1-{\frac{E[R_{V,C}]}{E[R_{N,C}]}


First of all we restricted the allowed values of the factors in order to have  experiments that properly resembles a Bar. The chosen values are:
    \begin{itemize}
    \item \mu_C &= [1.5;2.0]
    \item \mu_K &= [0.45;0.6]
    \item \pi_S &= 1-\pi_C
    \item \pi_C &= [0.1; 0.3]
    \item \pi_V &= 1.3-\pi_N]
    \item \pi_N &= [0.1;1.2]
    \item KitchenQueueType&= ["fifo""priority"]
  \end{itemize}



In order to grasp which of the factors contributes to a certain phenomenon and what its contribution is we computed a number of 2^kr (r = 5) factorial analysis. We will show them one by one and then discuss the more peculiar aspects. These will be the factors taken into consideration: 
  \begin{itemize}
    \item A = ratio between the amount of VIP and Normal users, by increasing it, the Normal arrival rate increases whereas Vip arrival rate decreases.
    \item B = odds of an order being a Compound one
    \item C = kitchen Rate
    \item D = cashier Rate
  \end{itemize}
In the Omnetpp configuration that we utilized we considered the exponential scenario with 5 repetitions.

\subsection{Fifo Scenario}

%\input{Analysis\Fifo\} TODO path to simpleResponseTimeRatio FIFO
 
There's no particular interplay occurring between factors, we can clearly see that the simpleResponseTimeRatio depends on:
\begin{itemize}
    \item The main reason why VIP users are privileged is due to the queueing of orders, if there's no queue the difference of Normal and Vip response times are negligible. This is exactly why the cashier rate has a negative contribution: with the increase of this factor there's less queueing and thus when a new normal order comes chances are that there will be no Vip users in queue so it can be served immediately.
  \item The ratio between the amount of VIP and Normal users (A) has a negative contribution, this is a little bit unexpected. The reason has a connection with the starvation of Normal users. Let's try to break it up in two cases: 
  \begin{itemize}
    \item Many VIP users, few Normal users: for obvious reasons VIP users are subdued to long queue so their response time will be lower. With the same reasoning the few Normal users will have to wait a long time before being served since, while being in queue, other VIP users will arrive, eventually inducing the normal order to starvation (with starvation we intend that there are very long response time but the orders will eventually be served).
    \item Few VIP users, many Normal users: now VIP users are very fast, but normal user are no more in starvation(long response time but much more reasonable). The Normal response time has lowered much more from the previous case, compared to the Vip response time, lowering the simpleResponseTimeRatio too.
    \end{itemize}
\end{itemize}

%\input{Analysis\Fifo\} TODO path to compoundResponseTimeRatio FIFO

%da decidere se inserire anche questa statistica

%\input{Analysis\Fifo\} TODO path to cashierVipQueueLength FIFO
We can observe that:
\begin{itemize}
    \item if the Vip arrival rate decreases (factor A increases) the VIP queue length will also decrease accordingly.
    \item by increasing the cashier rate Vip queue length will also decrease.
    \item Here we can also see an interesting interplay by factor A and D, meaning that a good portion of the variation is explained by the interaction of those factors.
\end{itemize}

%\input{Analysis\Fifo\} TODO path to cashierNormalQueueLength FIFO

Basically all the observation done for the cashierVipQueueLength remains with minor changes. We can observe that now factor A has a positive contribution, this was to be expected because by increasing factor A we increase the Normal arrival rate meaning that new Normal orders are subject to longer queue.

%\input{Analysis\Fifo\} TODO path to fifoQueueLength FIFO

In this particular scenario the kitchen has no priority queue. This means that all the orders coming from the cashier are treated in the same way, even if they are VIP. Of course, by that, we can expect that factor A would not bring any contribution to the variation and it's exactly what we can see from the results. Instead:
\begin{itemize}
    \item factor B has high positive contribution. By increasing it (probability of compound orders increase) we can expect longer queue.
    \item of course by increasing factor C (kitchen rate) we can expect shorter queue in the kitchen.
    \item Here we can also see an interesting interplay by factor A and D, meaning that a good portion of the variation is explained by the interaction of those factors.
\end{itemize}

\subsection{Priority Scenario}



For what concern the cashier all the observations done in the Fifo scenario still holds. In fact we can see that all the results are exactly the same, so we will not discuss this case any further and show them just for reference:

%\input{Analysis\Fifo\} TODO path to simpleResponseTimeRatio Priority

%\input{Analysis\Fifo\} TODO path to cashierVipQueueLength Priority

%\input{Analysis\Fifo\} TODO path to cashierNormalQueueLength Priority


%\input{Analysis\Fifo\} TODO path to compoundResponseTimeRatio Priority

%spiegazione


%\input{Analysis\Fifo\} TODO path to kitchenVipQueueLength Priority

\begin{itemize}
    \item by increasing factor A (Normal Arrival Rate increases, Vip arrival Rate decreases) the VIP queue length tends to decrease.
    \item by increasing factor B (probability of compound orders), the total inter-arrival rate of the kitchen increases too so new orders are more subject to queueing.
    \item of course, by increasing the Kitchen Rate (factor C) the length of VIP Queue length decreases.
    \item of course by being a Pasta system (no orders are created or destroyed inside the system), the inter-arrival rate of the cashier is also the inter-departure rate and, by that, we can be sure that the cashier rate (factors D) brings no contribution to the Normal Queue Length in the kitchen. %TODO da controllare
\end{itemize}

%\input{Analysis\Fifo\} TODO path to kitchenNormalQueueLength Priority

We can observe that:
\begin{itemize}
    \item by increasing factor A (Normal Arrival Rate increases) the Normal queue length tends to increase too.
    \item by increasing factor B (probability of compound orders), the total inter-arrival rate of the kitchen increases too so new orders are more subject to queueing.
    \item of course, by increasing the Kitchen Rate (factor C) the length of Normal Queue length decreases.
    \item of course by being a Pasta system (no orders are created or destroyed inside the system), the inter-arrival rate of the cashier is also the inter-departure rate and, by that, we can be sure that the cashier rate brings no contribution to the Normal Queue Length in the kitchen. %TODO da controllare
    \item all the interplays bring negligible contributions apart from the BC one which should be taken into consideration when tuning the system. %TODO dacontrollare
\end{itemize}

%TODO titolo per full factorial Fifo

One of the things that should be taken into consideration when fine-tuning the system is the amount of allowed VIP user. Of course if all users are VIP there would be no benefit, all the observation discussed till now would makes no sense and chance are that the few Normal user that comes will never be served. So, in order to decide the correct percentage of allowed VIP users, that permits a reasonable response time for Normal User along with some benefits to the Vip ones, we executed a full factorial analysis with the following configuration:
 
 %TODO configurazione Omnetpp

 By changing only the percentage of VIP users we can set a reasonable response time for Normal user (we opted for 15m) and establish the optimal percentage of Vip users that is between 10\% and 30\%.

 %TODO immagine grafico Norm Resp vs Vip resp

 We can also plot the simpleResponseTimeRatio with the same configuration and ensure that, in fact, Vip users are at least 80\% faster than Normal users in that range.

 %TODO immagino simpleRatioFifo

 Note that we have taken into consideration only the cashier Response Time because there's nothing special going on the kitchen, all users are treated equally. Basically the total Response Time can be seen as the cashier Response Time plus a constant. %TODO da controllare perche Ã¨ un'affermazione molto forte

%TODO titolo per full factorial Priority

All the above can be repeated for the Priority case to get similar results.

%TODO immagine comparison priorityByVipRate

%TODO immagine compound ratio (?)




\subsection{Data collection}